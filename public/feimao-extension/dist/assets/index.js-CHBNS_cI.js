console.log("Feimao Extension Background Service Worker Loaded");chrome.runtime.onInstalled.addListener(()=>{console.log("Feimao Extension installed")});chrome.runtime.onMessage.addListener((r,d,o)=>{if(r.action==="CLEAR_TEMU_COOKIES"){const s=[".temu.com",".temu.net","www.temu.com","www.temu.net"];return chrome.cookies.getAll({},i=>{let a=0;i.forEach(e=>{if(s.some(n=>e.domain.endsWith(n))){a++;const t=`${e.secure?"https:":"http:"}//${e.domain}${e.path}`;chrome.cookies.remove({url:t,name:e.name,storeId:e.storeId},()=>{a--,a<=0&&o({success:!0})})}}),a===0&&o({success:!0})}),!0}if(r.action==="API_REQUEST"){const{method:s,url:i,data:a,headers:e}=r.payload,n={method:s||"GET",headers:{"Content-Type":"application/json",...e||{}},body:s==="POST"||s==="PUT"?JSON.stringify(a):void 0};return fetch(i,n).then(async t=>{let c;const u=t.headers.get("content-type");u&&u.includes("application/json")?c=await t.json():c=await t.text(),t.ok?o({success:!0,data:c}):o({success:!1,error:c.message||t.statusText||"Request failed",status:t.status})}).catch(t=>{o({success:!1,error:t.message})}),!0}});
