console.log("Feimao Extension Background Service Worker Loaded");chrome.runtime.onInstalled.addListener(()=>{console.log("Feimao Extension installed")});chrome.runtime.onMessage.addListener((o,l,a)=>{if(o.action==="CLEAR_TEMU_COOKIES"){const t=[".temu.com",".temu.net","www.temu.com","www.temu.net"];return chrome.cookies.getAll({},c=>{let s=0;c.forEach(r=>{if(t.some(n=>r.domain.endsWith(n))){s++;const e=`${r.secure?"https:":"http:"}//${r.domain}${r.path}`;chrome.cookies.remove({url:e,name:r.name,storeId:r.storeId},()=>{s--,s<=0&&a({success:!0})})}}),s===0&&a({success:!0})}),!0}if(o.action==="FETCH_IMAGE_BASE64")return fetch(o.url).then(t=>t.blob()).then(t=>{const c=new FileReader;c.onloadend=()=>a({success:!0,data:c.result}),c.readAsDataURL(t)}).catch(t=>a({success:!1,error:t.message})),!0;if(o.action==="API_REQUEST"){const{method:t,url:c,data:s,headers:r}=o.payload,n={method:t||"GET",headers:{"Content-Type":"application/json",...r||{}},body:t==="POST"||t==="PUT"?JSON.stringify(s):void 0};return fetch(c,n).then(async e=>{let i;const u=e.headers.get("content-type");u&&u.includes("application/json")?i=await e.json():i=await e.text(),e.ok?a({success:!0,data:i}):a({success:!1,error:i.message||e.statusText||"Request failed",status:e.status})}).catch(e=>{a({success:!1,error:e.message})}),!0}if(o.action==="CAPTURE_VISIBLE_TAB")return chrome.tabs.captureVisibleTab(null,{format:"jpeg",quality:90},t=>{chrome.runtime.lastError?a({success:!1,error:chrome.runtime.lastError.message}):a({success:!0,data:t})}),!0});
